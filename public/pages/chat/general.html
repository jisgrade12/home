<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="../../images/12_l.png" />
    <link rel="stylesheet" href="../../stylesheets/style.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>
    <title>Grade 12 | General Chat</title>
    <style></style>
  </head>
  <body>
    <script src="https://www.gstatic.com/firebasejs/7.16.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.16.1/firebase-messaging.js"></script>
    <script>
      var config = {
        messagingSenderId: "189452419298",
        apiKey: "AIzaSyC0xyTcV8cLK_ducPzzXJOCDXwtcuU8qOI",
        projectId: "jis-grade12",
        appId: "1:189452419298:web:0ac371b7484ea023865ebb",
      };
      firebase.initializeApp(config);

      const messaging = firebase.messaging();
      messaging
        .requestPermission()
        .then(function () {
          console.log("Notification permission granted.");
          return messaging.getToken();
        })
        .then(function (token) {
          console.log("token is : " + token);
        })
        .catch(function (err) {
          console.log("Unable to get permission to notify.", err);
        });
    </script>

    <nav>
      <a href="../../index.html"
        ><img src="../../images/12_s.png" alt="Grade 12 Logo"
      /></a>
      <h1 id="nav-name">General Chat</h1>
      <span class="pages"
        ><a href="../../index.html"
          ><span class="material-symbols-outlined">
            home <span class="hover-info">Home</span></span
          ></a
        ><a href="../members.html"
          ><span class="material-symbols-outlined">
            group <span class="hover-info">Members</span></span
          ></a
        ><a href="../documents.html"
          ><span class="material-symbols-outlined">
            feed <span class="hover-info">Documents</span></span
          ></a
        ><a href="../timeline.html"
          ><span class="material-symbols-outlined">
            view_timeline <span class="hover-info">Timeline</span></span
          ></a
        ><a href="../chat.html" id="activated"
          ><span class="material-symbols-outlined">
            chat <span class="hover-info">Chatting</span></span
          ></a
        ><a href="../calendar.html"
          ><span class="material-symbols-outlined">
            calendar_month <span class="hover-info">Calendar</span></span
          ></a
        ><a href="../countdown.html"
          ><span class="material-symbols-outlined">
            hourglass_empty <span class="hover-info">Countdown(s)</span></span
          ></a
        ><a href="../games.html"
          ><span class="material-symbols-outlined">
            stadia_controller <span class="hover-info">Games</span></span
          ></a
        ><a href="../signup.html"
          ><span class="material-symbols-outlined">
            account_circle <span class="hover-info">Account</span></span
          ></a
        ></span
      >
    </nav>
    <div class="nav-resistance" id="tp"></div>
    <header>
      <h2>General</h2>
    </header>

    <div id="chat">
      <ul id="messages"></ul>
      <form id="message-form">
        <input id="message-input" type="text" class="chat" />
        <button id="message-btn" type="submit" class="msg">
          Send <span class="material-symbols-outlined"> send </span>
        </button>
      </form>
    </div>
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-database.js"></script>
    <script src="../../scripts/script.js" type="module"></script>
    <style>
      li {
        list-style-type: none;
        margin-bottom: 10px;
        background-color: #6929ca;
        padding: 5px;
        border-radius: 10px;
        color: white;
        width: 50%;
      }
      li span {
        font-style: italic;
        font-weight: bolder;
        color: #b5b0b9;
      }
    </style>
    <footer>
      &#169;
      <script>
        document.write(/\d{4}/.exec(Date())[0]);
      </script>
      JIS Grade 12 &#124; Made with &#10084; by Arsalan
    </footer>
    <script>
      const fetchChat = db.ref("messages/");
      fetchChat.on("child_added", function (snapshot) {
        const messages = snapshot.val();
        const message = `<li class=${
          username === messages.username ? "sent" : "receive"
        }><span>${messages.username}: </span>${messages.message}</li>`;
        document.getElementById("messages").innerHTML += message;
      });
    </script>
  </body>
</html>
